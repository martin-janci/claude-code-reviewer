services:
  reviewer:
    image: registry.rlt.sk/claude-code-reviewer:latest
    # build: .
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - WEBHOOK_SECRET=${WEBHOOK_SECRET:-}
    volumes:
      # IMPORTANT: Mount Claude auth to BOTH /root/.claude and /home/node/.claude
      # Some operations (git, gh) may run as root, others as node user
      - claude-auth:/root/.claude
      - claude-auth:/home/node/.claude
      - ./.claude/skills:/home/node/.claude/skills:ro
      - ./config.yaml:/app/config.yaml:ro
      - reviewer-data:/app/data
    ports:
      - "3000:3000"
    restart: unless-stopped

volumes:
  claude-auth:
  reviewer-data:
